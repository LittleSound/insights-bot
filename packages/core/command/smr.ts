import type { TgBot } from '~/share/types'

export function initCommand(bot: TgBot) {
  bot.command('smr', async (ctx) => {
    const url = ctx.message.text.replace('/smr ', '').trim()
    const loadingMessage = await ctx.reply('è¯·ç¨ç­‰ï¼Œé‡å­é€Ÿè¯»ä¸­...')
    try {
      const summarization = summarizeInputURL(url)
      await ctx.reply(summarization, { parse_mode: 'HTML' })
    }
    catch (err) {
      ctx.editMessageText('æš‚æ—¶ä¸æ”¯æŒé‡å­é€Ÿè¯»è¿™æ ·çš„å†…å®¹å‘¢ï¼Œå¯ä»¥æ¢ä¸ªåˆ«çš„é“¾æ¥è¯•è¯•ã€‚')
    }
  })

  bot.hears(/$(\/smr)|(\/smr ([^"]+))/g, async (ctx) => {
    const url = ctx.message.text.replace('/smr ', '').trim()
    const summarization = summarizeInputURL(url)
    await ctx.editMessageText(summarization, { parse_mode: 'HTML' })
  })
}

function summarizeInputURL(url: string) {
  return `<b><a href="${url}">{Title}</a></b>\n{Content}\n\n<em>ğŸ¤–ï¸ Generated by chatGPT</em>`
}
