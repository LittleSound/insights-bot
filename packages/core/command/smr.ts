import type { TgBot } from '~/share/types'

export function initCommand(bot: TgBot) {
  bot.command('smr', async (ctx) => {
    const url = ctx.message.text.replace('/smr ', '').trim()
    const loadingMessage = await ctx.reply('请稍等，量子速读中...')
    try {
      const summarization = summarizeInputURL(url)
      await ctx.reply(summarization, { parse_mode: 'HTML' })
    }
    catch (err) {
      ctx.editMessageText('暂时不支持量子速读这样的内容呢，可以换个别的链接试试。')
    }
  })

  bot.hears(/$(\/smr)|(\/smr ([^"]+))/g, async (ctx) => {
    const url = ctx.message.text.replace('/smr ', '').trim()
    const summarization = summarizeInputURL(url)
    await ctx.editMessageText(summarization, { parse_mode: 'HTML' })
  })
}

function summarizeInputURL(url: string) {
  return `<b><a href="${url}">{Title}</a></b>\n{Content}\n\n<em>🤖️ Generated by chatGPT</em>`
}
